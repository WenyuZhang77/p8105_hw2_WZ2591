---
title: "p8105_hw2_WZ2591"
author: "Wenyu Zhang"
date: "10/5/2021"
output: github_document
---

```{r}
library(tidyverse)
library(readxl)
```

# Problem 1
## Read and clean the Mr. Trash Wheel sheet:

1. specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel

2. use reasonable variable names

3. omit rows that do not include dumpster-specific data

4. round the number of sports balls to the nearest integer

```{r}
mr_trash_wheel = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", range = "A2:N535") %>% 
  janitor::clean_names() %>% 
  rename(weight = weight_tons, volume = volume_cubic_yards) %>% 
  filter(!is.na(dumpster)) %>%
  mutate(sports_balls = as.integer(round(sports_balls)))
```

## Read and clean precipitation data for 2018 and 2019:

```{r}
trash_wheel_precipitation_2018 = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = 7, range = "A2:B14") %>%
  janitor::clean_names() %>%
  rename(total_precipitation = total) %>%
  filter(!is.na(total_precipitation)) %>% 
  mutate(year = 2018, 
         month = month.name[month]) %>%
  relocate(year)

trash_wheel_precipitation_2018
```

```{r}
trash_wheel_precipitation_2019 = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = 6, range = "A2:B14") %>%
  janitor::clean_names() %>%
  rename(total_precipitation = total) %>%
  drop_na(total_precipitation) %>% 
  mutate(year = 2019, 
         month = month.name[month]) %>% 
  relocate(year)

trash_wheel_precipitation_2019
```

```{r}
# Combine precipitation datasets for 2018 and 2019
trash_wheel_precipitation_2018_2019 = 
  bind_rows(trash_wheel_precipitation_2018, trash_wheel_precipitation_2019)

trash_wheel_precipitation_2018_2019
```

## Write a paragraph about these data

For "mr_trash_wheel_data", there are `r nrow(mr_trash_wheel)` rows and `r ncol(mr_trash_wheel)` columns with 13 variables: dumpster, month, year, weight, volume, plastic_bottles, polystyrene, cigarette_butts, glass_bottles, grocery_bags, chip_bags, sports_balls and homes_powered.

```{r}
# Describe mr_trash_wheel data
skimr::skim(mr_trash_wheel)
nrow(mr_trash_wheel)
ncol(mr_trash_wheel)
```

For "trash_wheel_precipitation_2018_2019" data, there are `r nrow(trash_wheel_precipitation_2018_2019)` rows and `r ncol(trash_wheel_precipitation_2018_2019)` columns with 3 variables: month, year and total_precipitation

```{r}
# Describe trash_wheel_precipitation_2018_2019 data
skimr::skim(trash_wheel_precipitation_2018_2019)
nrow(trash_wheel_precipitation_2018_2019)
ncol(trash_wheel_precipitation_2018_2019)
```

For available data, what was the total precipitation in 2018? What was the median number of sports balls in a dumpster in 2019?

```{r}
# The total precipitation in 2018
sum(pull(trash_wheel_precipitation_2018,total_precipitation))

# The median number of sports balls in a dumpster in 2019
balls_in_2019 = filter(mr_trash_wheel, year == "2019")
median(pull(balls_in_2019, sports_balls))
```

The total precipitation in 201 is `r sum(pull(trash_wheel_precipitation_2018,total_precipitation))`, and the median number of sports balls in a dumpster in 2019 is `r median(pull(balls_in_2019, sports_balls))`

# Problem 2
##First, clean the data in pols-month.csv. 

1. Use separate() to break up the variable mon into integer variables year, month, and day

2. replace month number with month name

3. create a president variable taking values gop and dem, and remove prez_dem and prez_gop

4. remove the day variable.

```{r}
pols_month_df = 
  read_csv("data/fivethirtyeight_datasets/pols-month.csv") %>%   
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day")) %>% 
  mutate(month = month.name[as.numeric(month)], 
         year = as.numeric(year)) %>% 
  mutate(president = if_else(prez_gop == 0, "democreatic", "republican")) %>%
  select(-prez_dem, -prez_gop, -day)
```

## Second, clean the data in snp.csv using a similar process to the above. 

For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.

```{r}
snp_df = 
  read_csv("data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year")) %>% 
  mutate(month = month.name[as.numeric(month)], 
         year = as.numeric(year)) %>%
  select(year, month, day, close) %>%
  
  
  mutate(year = ifelse(year > 90, year + 1900, year + 2000)) %>% 
  
  
  arrange(year, month)
```

## Third, tidy the unemployment data so that it can be merged with the previous datasets. 

This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r}
unemployment_df = 
  read_csv("data/fivethirtyeight_datasets/unemployment.csv") %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment") %>%
  mutate(month = month.name[match(month,month.abb)])
```

Join the datasets by merging snp into pols, and merging unemployment into the result.

```{r}
pols_snp = left_join(pols_month_df, snp_df) 
```





